const myPump = require('../../lib/ingestEstablishments');

// kinesis records are based64 encoded
const localRecords =[
    // simple string -this is today
    {
        kinesis: {
            data: 'dGhpcyBpcyB0b2RheQ=='
        }
    },
    // establishment - "updated": "2019-04-06T09:54:10.562Z"
    {
        kinesis: {
            data: 'ewogICJhY3Rpb24iOiAiVXBkYXRlZCIsCiAgImVzdGFibGlzaG1lbnQiIDogewogICAgImlkIjogNDc5LAogICAgInVpZCI6ICI5OGE4M2VlZi1lMWUxLTQ5ZjMtODljNS1iMTI4N2EzY2M4ZGQiLAogICAgIm5hbWUiOiAiTmV3IGFuZCBJbXByb3ZlZCBXT1ppVGVjaCBDYXJlcyIsCiAgICAiYWRkcmVzcyI6ICJMaW5lIDEgTGluZSAyIFBhcnQgMSwgTGluZSAyIFBhcnQgMiBNeSBUb3duIE15IENvdW50eSIsCiAgICAicG9zdGNvZGUiOiAiU0UxOSAzTlMiLAogICAgImxvY2F0aW9uUmVmIjogbnVsbCwKICAgICJpc1JlZ3VsYXRlZCI6IGZhbHNlLAogICAgIm5tZHNJZCI6ICJHMTAwMTExNCIsCiAgICAiY3JlYXRlZCI6ICIyMDE5LTAzLTE1VDA5OjU0OjEwLjU2MloiLAogICAgInVwZGF0ZWQiOiAiMjAxOS0wNC0wNlQwOTo1NDoxMC41NjJaIiwKICAgICJ1cGRhdGVkQnkiOiAiYXlsaW5ndyIsCiAgICAibWFpblNlcnZpY2UiOiB7CiAgICAgICJpZCI6IDgsCiAgICAgICJuYW1lIjogIlNvY2lhbCB3b3JrIGFuZCBjYXJlIG1hbmFnZW1lbnQiCiAgICB9LAogICAgImVtcGxveWVyVHlwZSI6ICJMb2NhbCBBdXRob3JpdHkgKGdlbmVyaWMvb3RoZXIpIiwKICAgICJudW1iZXJPZlN0YWZmIjogMywKICAgICJvdGhlclNlcnZpY2VzIjogWwogICAgICB7CiAgICAgICAgImNhdGVnb3J5IjogIkFkdWx0IGRheSIsCiAgICAgICAgInNlcnZpY2VzIjogWwogICAgICAgICAgewogICAgICAgICAgICAiaWQiOiA5LAogICAgICAgICAgICAibmFtZSI6ICJEYXkgY2FyZSBhbmQgZGF5IHNlcnZpY2VzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfSwKICAgICAgewogICAgICAgICJjYXRlZ29yeSI6ICJPdGhlciIsCiAgICAgICAgInNlcnZpY2VzIjogWwogICAgICAgICAgewogICAgICAgICAgICAiaWQiOiAxNSwKICAgICAgICAgICAgIm5hbWUiOiAiQW55IG90aGVyIHNlcnZpY2VzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgXSwKICAgICJzZXJ2aWNlVXNlcnMiOiBbCiAgICAgIHsKICAgICAgICAiaWQiOiA5LAogICAgICAgICJncm91cCI6ICJPbGRlciBwZW9wbGUiLAogICAgICAgICJzZXJ2aWNlIjogIk9sZGVyIHBlb3BsZSBub3QgaW4gYWJvdmUgY2F0ZWdvcmllcyIKICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDExLAogICAgICAgICJncm91cCI6ICJBZHVsdHMiLAogICAgICAgICJzZXJ2aWNlIjogIkFkdWx0cyB3aXRoIG1lbnRhbCBkaXNvcmRlcnMgb3IgaW5maXJtaXRpZXMsIGV4Y2x1ZGluZyBsZWFybmluZyBkaXNhYmlsaXR5IG9yIGRlbWVudGlhIgogICAgICB9CiAgICBdLAogICAgImNhcGFjaXRpZXMiOiBbCiAgICAgIHsKICAgICAgICAicXVlc3Rpb24iOiAiSG93IG1hbnkgcGxhY2VzIGRvIHlvdSBjdXJyZW50bHkgaGF2ZT8iLAogICAgICAgICJxdWVzdGlvbklkIjogOCwKICAgICAgICAic2VxIjogMCwKICAgICAgICAiYW5zd2VyIjogMjEKICAgICAgfSwKICAgICAgewogICAgICAgICJxdWVzdGlvbiI6ICJOdW1iZXIgb2YgcGVvcGxlIHVzaW5nIHRoZSBzZXJ2aWNlIG9uIHRoZSBjb21wbGV0aW9uIGRhdGUiLAogICAgICAgICJxdWVzdGlvbklkIjogOSwKICAgICAgICAic2VxIjogMCwKICAgICAgICAiYW5zd2VyIjogMTIKICAgICAgfQogICAgXSwKICAgICJzaGFyZSI6IHsKICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAid2l0aCI6IFsKICAgICAgICAiQ1FDIgogICAgICBdCiAgICB9LAogICAgImxvY2FsQXV0aG9yaXRpZXMiOiBbCiAgICAgIHsKICAgICAgICAiaWQiOiA0MjEsCiAgICAgICAgImN1c3RvZGlhbkNvZGUiOiA3MjAsCiAgICAgICAgIm5hbWUiOiAiQnJvbWxleSIKICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDQyMiwKICAgICAgICAiY3VzdG9kaWFuQ29kZSI6IDIwNCwKICAgICAgICAibmFtZSI6ICJCYXJuc2xleSIKICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDQyMywKICAgICAgICAiY3VzdG9kaWFuQ29kZSI6IDcyMSwKICAgICAgICAibmFtZSI6ICJDcm95ZG9uIiwKICAgICAgICAiaXNQcmltYXJ5QXV0aG9yaXR5IjogdHJ1ZQogICAgICB9CiAgICBdLAogICAgInByaW1hcnlBdXRob3JpdHkiOiB7CiAgICAgICJjdXN0b2RpYW5Db2RlIjogNzIxLAogICAgICAibmFtZSI6ICJDcm95ZG9uIgogICAgfSwKICAgICJWYWNhbmNpZXMiOiBbCiAgICAgIHsKICAgICAgICAiam9iSWQiOiAxLAogICAgICAgICJ0aXRsZSI6ICJBY3Rpdml0aWVzIHdvcmtlciBvciBjby1vcmRpbmF0b3IiLAogICAgICAgICJ0b3RhbCI6IDk5OQogICAgICB9LAogICAgICB7CiAgICAgICAgImpvYklkIjogMTAsCiAgICAgICAgInRpdGxlIjogIkNhcmUgV29ya2VyIiwKICAgICAgICAidG90YWwiOiAzMzMKICAgICAgfQogICAgXSwKICAgICJUb3RhbFZhY2VuY2llcyI6IDEzMzIsCiAgICAiU3RhcnRlcnMiOiAiTm9uZSIsCiAgICAiVG90YWxTdGFydGVycyI6IDAsCiAgICAiTGVhdmVycyI6ICJEb24ndCBrbm93IiwKICAgICJUb3RhbExlYXZlcnMiOiAwLAogICAgIndkZiI6IHsKICAgICAgImVmZmVjdGl2ZUZyb20iOiAiMjAxOC0wMy0zMFQwMzozMDowMC4wMDBaIiwKICAgICAgImlzRWxpZ2libGUiOiBmYWxzZSwKICAgICAgImVtcGxveWVyVHlwZSI6IHRydWUsCiAgICAgICJtYWluU2VydmljZSI6IHRydWUsCiAgICAgICJvdGhlclNlcnZpY2UiOiB0cnVlLAogICAgICAiY2FwYWNpdGllcyI6IHRydWUsCiAgICAgICJzZXJ2aWNlVXNlcnMiOiB0cnVlLAogICAgICAidmFjYW5jaWVzIjogdHJ1ZSwKICAgICAgInN0YXJ0ZXJzIjogdHJ1ZSwKICAgICAgImxlYXZlcnMiOiB0cnVlLAogICAgICAic3RhZmYiOiB0cnVlLAogICAgICAid2VpZ2h0ZWRTdGFmZiI6IHRydWUKICAgIH0KICB9Cn0K'
        }
    },
    // worker
    {
        kinesis: {
            data: 'ewogICJhY3Rpb24iOiAiQ3JlYXRlZCIsCiAgIndvcmtlciIgOiB7CiAgICAidWlkIjogIjM5ZGQ3ODA4LWE3NWUtNDEzNC05NDQzLWYyYzI2NmFmMGZkMSIsCiAgICAiZXN0YWJsaXNobWVudElkIjogNDc5LAogICAgImNyZWF0ZWQiOiAiMjAxOS0wMy0zMFQxMTo0Mjo0OC4xNjZaIiwKICAgICJ1cGRhdGVkIjogIjIwMTktMDMtMzBUMTE6NDI6NDguMTY2WiIsCiAgICAidXBkYXRlZEJ5IjogImF5bGluZ3ciLAogICAgImNvbXBsZXRlZCI6IGZhbHNlLAogICAgImNvbnRyYWN0IjogIlRlbXBvcmFyeSIsCiAgICAibmFtZU9ySWQiOiAiTGFzdCBGaXZlIiwKICAgICJtYWluSm9iIjogewogICAgICAiam9iSWQiOiAxOCwKICAgICAgInRpdGxlIjogIk9jY3VwYXRpb25hbCBUaGVyYXBpc3QiCiAgICB9LAogICAgIndkZiI6IHsKICAgICAgImVmZmVjdGl2ZUZyb20iOiAiMjAxOS0wMy0yOVQwMzozMDowMC4wMDBaIiwKICAgICAgImlzRWxpZ2libGUiOiBmYWxzZSwKICAgICAgImdlbmRlciI6IGZhbHNlLAogICAgICAiZGF0ZU9mQmlydGgiOiBmYWxzZSwKICAgICAgIm5hdGlvbmFsaXR5IjogZmFsc2UsCiAgICAgICJtYWluSm9iIjogdHJ1ZSwKICAgICAgIm90aGVySm9icyI6IGZhbHNlLAogICAgICAibWFpbkpvYlN0YXJ0RGF0ZSI6IGZhbHNlLAogICAgICAicmVjcnVpdGVkRnJvbSI6IGZhbHNlLAogICAgICAiY29udHJhY3QiOiB0cnVlLAogICAgICAid2Vla2x5SG91cnNDb250cmFjdGVkIjogZmFsc2UsCiAgICAgICJ3ZWVrbHlIb3Vyc0F2ZXJhZ2UiOiBmYWxzZSwKICAgICAgInplcm9Ib3Vyc0NvbnRyYWN0IjogZmFsc2UsCiAgICAgICJkYXlzU2ljayI6IGZhbHNlLAogICAgICAiYW5udWFsSG91cmx5UGF5IjogZmFsc2UsCiAgICAgICJjYXJlQ2VydGlmaWNhdGUiOiBmYWxzZSwKICAgICAgInF1YWxpZmljYXRpb25JblNvY2lhbENhcmUiOiBmYWxzZSwKICAgICAgInNvY2lhbENhcmVRdWFsaWZpY2F0aW9uIjogZmFsc2UsCiAgICAgICJvdGhlclF1YWxpZmljYXRpb24iOiBmYWxzZSwKICAgICAgImhpZ2hlc3RRdWFsaWZpY2F0aW9uIjogZmFsc2UKICAgIH0gIAogIH0KfQ=='
        }
    },
    // establishment - "updated": "2019-04-06T09:04:23.713Z"
    {
        kinesis: {
            data: 'ewogICJhY3Rpb24iOiAiVXBkYXRlZCIsCiAgImVzdGFibGlzaG1lbnQiIDogewogICAgImlkIjogNDc5LAogICAgInVpZCI6ICI5OGE4M2VlZi1lMWUxLTQ5ZjMtODljNS1iMTI4N2EzY2M4ZGQiLAogICAgIm5hbWUiOiAiTmV3IGFuZCBJbXByb3ZlZCBXT1ppVGVjaCBDYXJlcyIsCiAgICAiYWRkcmVzcyI6ICJMaW5lIDEgTGluZSAyIFBhcnQgMSwgTGluZSAyIFBhcnQgMiBNeSBUb3duIE15IENvdW50eSIsCiAgICAicG9zdGNvZGUiOiAiU0UxOSAzTlMiLAogICAgImxvY2F0aW9uUmVmIjogbnVsbCwKICAgICJpc1JlZ3VsYXRlZCI6IGZhbHNlLAogICAgIm5tZHNJZCI6ICJHMTAwMTExNCIsCiAgICAiY3JlYXRlZCI6ICIyMDE5LTAzLTE1VDA5OjU0OjEwLjU2MloiLAogICAgInVwZGF0ZWQiOiAiMjAxOS0wNC0wNlQwOTowNDoyMy43MTNaIiwKICAgICJ1cGRhdGVkQnkiOiAiYXlsaW5ndyIsCiAgICAibWFpblNlcnZpY2UiOiB7CiAgICAgICJpZCI6IDgsCiAgICAgICJuYW1lIjogIlNvY2lhbCB3b3JrIGFuZCBjYXJlIG1hbmFnZW1lbnQiCiAgICB9LAogICAgImVtcGxveWVyVHlwZSI6ICJMb2NhbCBBdXRob3JpdHkgKGdlbmVyaWMvb3RoZXIpIiwKICAgICJudW1iZXJPZlN0YWZmIjogMywKICAgICJvdGhlclNlcnZpY2VzIjogWwogICAgICB7CiAgICAgICAgImNhdGVnb3J5IjogIkFkdWx0IGRheSIsCiAgICAgICAgInNlcnZpY2VzIjogWwogICAgICAgICAgewogICAgICAgICAgICAiaWQiOiA5LAogICAgICAgICAgICAibmFtZSI6ICJEYXkgY2FyZSBhbmQgZGF5IHNlcnZpY2VzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfSwKICAgICAgewogICAgICAgICJjYXRlZ29yeSI6ICJPdGhlciIsCiAgICAgICAgInNlcnZpY2VzIjogWwogICAgICAgICAgewogICAgICAgICAgICAiaWQiOiAxNSwKICAgICAgICAgICAgIm5hbWUiOiAiQW55IG90aGVyIHNlcnZpY2VzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgXSwKICAgICJzZXJ2aWNlVXNlcnMiOiBbCiAgICAgIHsKICAgICAgICAiaWQiOiA5LAogICAgICAgICJncm91cCI6ICJPbGRlciBwZW9wbGUiLAogICAgICAgICJzZXJ2aWNlIjogIk9sZGVyIHBlb3BsZSBub3QgaW4gYWJvdmUgY2F0ZWdvcmllcyIKICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDExLAogICAgICAgICJncm91cCI6ICJBZHVsdHMiLAogICAgICAgICJzZXJ2aWNlIjogIkFkdWx0cyB3aXRoIG1lbnRhbCBkaXNvcmRlcnMgb3IgaW5maXJtaXRpZXMsIGV4Y2x1ZGluZyBsZWFybmluZyBkaXNhYmlsaXR5IG9yIGRlbWVudGlhIgogICAgICB9CiAgICBdLAogICAgImNhcGFjaXRpZXMiOiBbCiAgICAgIHsKICAgICAgICAicXVlc3Rpb24iOiAiSG93IG1hbnkgcGxhY2VzIGRvIHlvdSBjdXJyZW50bHkgaGF2ZT8iLAogICAgICAgICJxdWVzdGlvbklkIjogOCwKICAgICAgICAic2VxIjogMCwKICAgICAgICAiYW5zd2VyIjogMjEKICAgICAgfSwKICAgICAgewogICAgICAgICJxdWVzdGlvbiI6ICJOdW1iZXIgb2YgcGVvcGxlIHVzaW5nIHRoZSBzZXJ2aWNlIG9uIHRoZSBjb21wbGV0aW9uIGRhdGUiLAogICAgICAgICJxdWVzdGlvbklkIjogOSwKICAgICAgICAic2VxIjogMCwKICAgICAgICAiYW5zd2VyIjogMTIKICAgICAgfQogICAgXSwKICAgICJzaGFyZSI6IHsKICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAid2l0aCI6IFsKICAgICAgICAiQ1FDIgogICAgICBdCiAgICB9LAogICAgImxvY2FsQXV0aG9yaXRpZXMiOiBbCiAgICAgIHsKICAgICAgICAiaWQiOiA0MjEsCiAgICAgICAgImN1c3RvZGlhbkNvZGUiOiA3MjAsCiAgICAgICAgIm5hbWUiOiAiQnJvbWxleSIKICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDQyMiwKICAgICAgICAiY3VzdG9kaWFuQ29kZSI6IDIwNCwKICAgICAgICAibmFtZSI6ICJCYXJuc2xleSIKICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDQyMywKICAgICAgICAiY3VzdG9kaWFuQ29kZSI6IDcyMSwKICAgICAgICAibmFtZSI6ICJDcm95ZG9uIiwKICAgICAgICAiaXNQcmltYXJ5QXV0aG9yaXR5IjogdHJ1ZQogICAgICB9CiAgICBdLAogICAgInByaW1hcnlBdXRob3JpdHkiOiB7CiAgICAgICJjdXN0b2RpYW5Db2RlIjogNzIxLAogICAgICAibmFtZSI6ICJDcm95ZG9uIgogICAgfSwKICAgICJWYWNhbmNpZXMiOiBbCiAgICAgIHsKICAgICAgICAiam9iSWQiOiAxLAogICAgICAgICJ0aXRsZSI6ICJBY3Rpdml0aWVzIHdvcmtlciBvciBjby1vcmRpbmF0b3IiLAogICAgICAgICJ0b3RhbCI6IDk5OQogICAgICB9LAogICAgICB7CiAgICAgICAgImpvYklkIjogMTAsCiAgICAgICAgInRpdGxlIjogIkNhcmUgV29ya2VyIiwKICAgICAgICAidG90YWwiOiAzMzMKICAgICAgfQogICAgXSwKICAgICJUb3RhbFZhY2VuY2llcyI6IDEzMzIsCiAgICAiU3RhcnRlcnMiOiAiTm9uZSIsCiAgICAiVG90YWxTdGFydGVycyI6IDAsCiAgICAiTGVhdmVycyI6ICJEb24ndCBrbm93IiwKICAgICJUb3RhbExlYXZlcnMiOiAwLAogICAgIndkZiI6IHsKICAgICAgImVmZmVjdGl2ZUZyb20iOiAiMjAxOC0wMy0zMFQwMzozMDowMC4wMDBaIiwKICAgICAgImlzRWxpZ2libGUiOiBmYWxzZSwKICAgICAgImVtcGxveWVyVHlwZSI6IHRydWUsCiAgICAgICJtYWluU2VydmljZSI6IHRydWUsCiAgICAgICJvdGhlclNlcnZpY2UiOiB0cnVlLAogICAgICAiY2FwYWNpdGllcyI6IHRydWUsCiAgICAgICJzZXJ2aWNlVXNlcnMiOiB0cnVlLAogICAgICAidmFjYW5jaWVzIjogdHJ1ZSwKICAgICAgInN0YXJ0ZXJzIjogdHJ1ZSwKICAgICAgImxlYXZlcnMiOiB0cnVlLAogICAgICAic3RhZmYiOiB0cnVlLAogICAgICAid2VpZ2h0ZWRTdGFmZiI6IHRydWUKICAgIH0KICB9Cn0K'
        }
    },
];

const runIngest = async () => {
    try {
        console.log("About to call Ingest Establishments handler");

        const returnVal = await myPump.handler(
            {
                Records: localRecords
            },
            { invokedFunctionArn : 'arn:aws:lambda:eu-west-1:accountid:function:sfc-ingestEstablishment' }
        );
        console.log("Handler returned: ", returnVal);
    } catch (err) {
        console.error("Caught local error: ", err);
    }
}

process.env.LOG_LEVEL = 5;
process.env.SLACK_LEVEL = 0;
runIngest();