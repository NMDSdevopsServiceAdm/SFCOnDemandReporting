const myPump = require('../../lib/ingestEstablishments');

// kinesis records are based64 encoded
const localRecords =[
    {
        kinesis: {
            data: 'dGhpcyBpcyB0b2RheQ=='
        }
    },
    {
        kinesis: {
            data: 'ewogICJ1aWQiOiAiMzlkZDc4MDgtYTc1ZS00MTM0LTk0NDMtZjJjMjY2YWYwZmQxIiwKICAiZXN0YWJsaXNobWVudElkIjogNDc5LAogICJjcmVhdGVkIjogIjIwMTktMDMtMzBUMTE6NDI6NDguMTY2WiIsCiAgInVwZGF0ZWQiOiAiMjAxOS0wMy0zMFQxMTo0Mjo0OC4xNjZaIiwKICAidXBkYXRlZEJ5IjogImF5bGluZ3ciLAogICJjb21wbGV0ZWQiOiBmYWxzZSwKICAiY29udHJhY3QiOiAiVGVtcG9yYXJ5IiwKICAibmFtZU9ySWQiOiAiTGFzdCBGaXZlIiwKICAibWFpbkpvYiI6IHsKICAgICJqb2JJZCI6IDE4LAogICAgInRpdGxlIjogIk9jY3VwYXRpb25hbCBUaGVyYXBpc3QiCiAgfSwKICAid2RmIjogewogICAgImVmZmVjdGl2ZUZyb20iOiAiMjAxOS0wMy0yOVQwMzozMDowMC4wMDBaIiwKICAgICJpc0VsaWdpYmxlIjogZmFsc2UsCiAgICAiZ2VuZGVyIjogZmFsc2UsCiAgICAiZGF0ZU9mQmlydGgiOiBmYWxzZSwKICAgICJuYXRpb25hbGl0eSI6IGZhbHNlLAogICAgIm1haW5Kb2IiOiB0cnVlLAogICAgIm90aGVySm9icyI6IGZhbHNlLAogICAgIm1haW5Kb2JTdGFydERhdGUiOiBmYWxzZSwKICAgICJyZWNydWl0ZWRGcm9tIjogZmFsc2UsCiAgICAiY29udHJhY3QiOiB0cnVlLAogICAgIndlZWtseUhvdXJzQ29udHJhY3RlZCI6IGZhbHNlLAogICAgIndlZWtseUhvdXJzQXZlcmFnZSI6IGZhbHNlLAogICAgInplcm9Ib3Vyc0NvbnRyYWN0IjogZmFsc2UsCiAgICAiZGF5c1NpY2siOiBmYWxzZSwKICAgICJhbm51YWxIb3VybHlQYXkiOiBmYWxzZSwKICAgICJjYXJlQ2VydGlmaWNhdGUiOiBmYWxzZSwKICAgICJxdWFsaWZpY2F0aW9uSW5Tb2NpYWxDYXJlIjogZmFsc2UsCiAgICAic29jaWFsQ2FyZVF1YWxpZmljYXRpb24iOiBmYWxzZSwKICAgICJvdGhlclF1YWxpZmljYXRpb24iOiBmYWxzZSwKICAgICJoaWdoZXN0UXVhbGlmaWNhdGlvbiI6IGZhbHNlCiAgfQp9'
        }
    },
    {
        kinesis: {
            data: 'ewogICJpZCI6IDQ3OSwKICAidWlkIjogIjk4YTgzZWVmLWUxZTEtNDlmMy04OWM1LWIxMjg3YTNjYzhkZCIsCiAgIm5hbWUiOiAiTmV3IGFuZCBJbXByb3ZlZCBXT1ppVGVjaCBDYXJlcyIsCiAgImFkZHJlc3MiOiAiTGluZSAxIExpbmUgMiBQYXJ0IDEsIExpbmUgMiBQYXJ0IDIgTXkgVG93biBNeSBDb3VudHkiLAogICJwb3N0Y29kZSI6ICJTRTE5IDNOUyIsCiAgImxvY2F0aW9uUmVmIjogbnVsbCwKICAiaXNSZWd1bGF0ZWQiOiBmYWxzZSwKICAibm1kc0lkIjogIkcxMDAxMTE0IiwKICAiY3JlYXRlZCI6ICIyMDE5LTAzLTE1VDA5OjU0OjEwLjU2MloiLAogICJ1cGRhdGVkIjogIjIwMTktMDQtMDZUMDk6MDQ6MjMuNzEzWiIsCiAgInVwZGF0ZWRCeSI6ICJheWxpbmd3IiwKICAibWFpblNlcnZpY2UiOiB7CiAgICAiaWQiOiA4LAogICAgIm5hbWUiOiAiU29jaWFsIHdvcmsgYW5kIGNhcmUgbWFuYWdlbWVudCIKICB9LAogICJlbXBsb3llclR5cGUiOiAiTG9jYWwgQXV0aG9yaXR5IChnZW5lcmljL290aGVyKSIsCiAgIm51bWJlck9mU3RhZmYiOiAzLAogICJvdGhlclNlcnZpY2VzIjogWwogICAgewogICAgICAiY2F0ZWdvcnkiOiAiQWR1bHQgZGF5IiwKICAgICAgInNlcnZpY2VzIjogWwogICAgICAgIHsKICAgICAgICAgICJpZCI6IDksCiAgICAgICAgICAibmFtZSI6ICJEYXkgY2FyZSBhbmQgZGF5IHNlcnZpY2VzIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImNhdGVnb3J5IjogIk90aGVyIiwKICAgICAgInNlcnZpY2VzIjogWwogICAgICAgIHsKICAgICAgICAgICJpZCI6IDE1LAogICAgICAgICAgIm5hbWUiOiAiQW55IG90aGVyIHNlcnZpY2VzIgogICAgICAgIH0KICAgICAgXQogICAgfQogIF0sCiAgInNlcnZpY2VVc2VycyI6IFsKICAgIHsKICAgICAgImlkIjogOSwKICAgICAgImdyb3VwIjogIk9sZGVyIHBlb3BsZSIsCiAgICAgICJzZXJ2aWNlIjogIk9sZGVyIHBlb3BsZSBub3QgaW4gYWJvdmUgY2F0ZWdvcmllcyIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6IDExLAogICAgICAiZ3JvdXAiOiAiQWR1bHRzIiwKICAgICAgInNlcnZpY2UiOiAiQWR1bHRzIHdpdGggbWVudGFsIGRpc29yZGVycyBvciBpbmZpcm1pdGllcywgZXhjbHVkaW5nIGxlYXJuaW5nIGRpc2FiaWxpdHkgb3IgZGVtZW50aWEiCiAgICB9CiAgXSwKICAiY2FwYWNpdGllcyI6IFsKICAgIHsKICAgICAgInF1ZXN0aW9uIjogIkhvdyBtYW55IHBsYWNlcyBkbyB5b3UgY3VycmVudGx5IGhhdmU/IiwKICAgICAgInF1ZXN0aW9uSWQiOiA4LAogICAgICAic2VxIjogMCwKICAgICAgImFuc3dlciI6IDIxCiAgICB9LAogICAgewogICAgICAicXVlc3Rpb24iOiAiTnVtYmVyIG9mIHBlb3BsZSB1c2luZyB0aGUgc2VydmljZSBvbiB0aGUgY29tcGxldGlvbiBkYXRlIiwKICAgICAgInF1ZXN0aW9uSWQiOiA5LAogICAgICAic2VxIjogMCwKICAgICAgImFuc3dlciI6IDEyCiAgICB9CiAgXSwKICAic2hhcmUiOiB7CiAgICAiZW5hYmxlZCI6IHRydWUsCiAgICAid2l0aCI6IFsKICAgICAgIkNRQyIKICAgIF0KICB9LAogICJsb2NhbEF1dGhvcml0aWVzIjogWwogICAgewogICAgICAiaWQiOiA0MjEsCiAgICAgICJjdXN0b2RpYW5Db2RlIjogNzIwLAogICAgICAibmFtZSI6ICJCcm9tbGV5IgogICAgfSwKICAgIHsKICAgICAgImlkIjogNDIyLAogICAgICAiY3VzdG9kaWFuQ29kZSI6IDIwNCwKICAgICAgIm5hbWUiOiAiQmFybnNsZXkiCiAgICB9LAogICAgewogICAgICAiaWQiOiA0MjMsCiAgICAgICJjdXN0b2RpYW5Db2RlIjogNzIxLAogICAgICAibmFtZSI6ICJDcm95ZG9uIiwKICAgICAgImlzUHJpbWFyeUF1dGhvcml0eSI6IHRydWUKICAgIH0KICBdLAogICJwcmltYXJ5QXV0aG9yaXR5IjogewogICAgImN1c3RvZGlhbkNvZGUiOiA3MjEsCiAgICAibmFtZSI6ICJDcm95ZG9uIgogIH0sCiAgIlZhY2FuY2llcyI6IFsKICAgIHsKICAgICAgImpvYklkIjogMSwKICAgICAgInRpdGxlIjogIkFjdGl2aXRpZXMgd29ya2VyIG9yIGNvLW9yZGluYXRvciIsCiAgICAgICJ0b3RhbCI6IDk5OQogICAgfSwKICAgIHsKICAgICAgImpvYklkIjogMTAsCiAgICAgICJ0aXRsZSI6ICJDYXJlIFdvcmtlciIsCiAgICAgICJ0b3RhbCI6IDMzMwogICAgfQogIF0sCiAgIlRvdGFsVmFjZW5jaWVzIjogMTMzMiwKICAiU3RhcnRlcnMiOiAiTm9uZSIsCiAgIlRvdGFsU3RhcnRlcnMiOiAwLAogICJMZWF2ZXJzIjogIkRvbid0IGtub3ciLAogICJUb3RhbExlYXZlcnMiOiAwLAogICJ3ZGYiOiB7CiAgICAiZWZmZWN0aXZlRnJvbSI6ICIyMDE4LTAzLTMwVDAzOjMwOjAwLjAwMFoiLAogICAgImlzRWxpZ2libGUiOiBmYWxzZSwKICAgICJlbXBsb3llclR5cGUiOiB0cnVlLAogICAgIm1haW5TZXJ2aWNlIjogdHJ1ZSwKICAgICJvdGhlclNlcnZpY2UiOiB0cnVlLAogICAgImNhcGFjaXRpZXMiOiB0cnVlLAogICAgInNlcnZpY2VVc2VycyI6IHRydWUsCiAgICAidmFjYW5jaWVzIjogdHJ1ZSwKICAgICJzdGFydGVycyI6IHRydWUsCiAgICAibGVhdmVycyI6IHRydWUsCiAgICAic3RhZmYiOiB0cnVlLAogICAgIndlaWdodGVkU3RhZmYiOiB0cnVlCiAgfQp9'
        }
    }
];

const runIngest = async () => {
    try {
        console.log("About to call Ingest Establishments handler");

        const returnVal = await myPump.handler(
            {
                Records: localRecords
            },
            { invokedFunctionArn : 'arn:aws:lambda:eu-west-1:accountid:function:sfc-ingestEstablishment' }
        );
        console.log("Handler returned: ", returnVal);
    } catch (err) {
        console.error("Caught local error: ", err);
    }
}

process.env.LOG_LEVEL = 5;
process.env.SLACK_LEVEL = 0;
runIngest();